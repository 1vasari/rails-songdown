<div class="header">
  <h1><%= @setlist.title %></h1>
</div>

<div class="content">
  <div class="pure-g">
    <div class="pure-u-2-3">
      <% if !@setlist.notes.empty? %>
        <div>
          <h2>Notes</h2>
          <div style="white-space: pre;"><%= @setlist.notes %></div>
        </div>
      <% end %>
    </div>

    <div class="pure-u-1-3">
      <%= link_to 'Edit', edit_setlist_path(@setlist), class: 'pure-button pure-button-primary' %>
    </div>

    <div class="pure-u-1">
      <h2>Songs</h2>

      <table class="pure-table pure-table-bordered">
        <thead>
          <tr>
            <th>
              Key
            </th>

            <th>
              Song
            </th>

            <th>
            </th>
          </tr>
        </thead>

        <tbody>
          <% @setlist.items.find_each do |item| %>
            <tr>
              <td>
                <%= form_tag setlist_update_song_path(setlist_id: @setlist.id, song_id: item.id), class: 'pure-form', method: :get do %>
                <%= hidden_field_tag :song_id, item.id %>
                  <%= select_tag(:key, options_for_select([
                    ['C major / A minor', 'C'],
                    ['Db major / Bb minor', 'Db'],
                    ['D major / B minor', 'D'],
                    ['Eb major / C minor', 'Eb'],
                    ['E major / C# minor', 'E'],
                    ['F major / D minor', 'F'],
                    ['Gb major / Eb minor', 'Gb'],
                    ['G major / E minor', 'G'],
                    ['Ab major / F minor', 'Ab'],
                    ['A major / F# minor', 'A'],
                    ['Bb major / G minor', 'Bb'],
                    ['B major / G# minor', 'B'],
                  ], item.key), :onchange => 'this.form.submit()') %>
                <% end %>
              </td>

              <td>
                <%= link_to item.song.full_name,
                  song_path(item.song_id, :key => item.key),
                  :class => 'fancy-link'
                %>
              </td>

              <td>
                <%= link_to 'Remove',
                  setlist_songs_path(:setlist_id => @setlist.id, :id => item.id),
                  :method => 'delete',
                  :class => 'pure-button pure-button-danger',
                  :data => {
                    :confirm =>
                      "Are you sure you want to remove \"#{item.song.title}\" from the setlist?"
                  }
                %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="pure-u-1">
      <h2>Add a Song</h2>

      <%= form_tag setlist_search_songs_path(@setlist),
        method: 'post',
        remote: true,
        class: 'pure-form custom-form' do
      %>

        <%= text_field_tag :query, '',
          autocomplete: 'off',
          placeholder: 'Enter title or artist'
        %>

        <%= submit_tag 'Search', class: 'pure-button pure-button-primary' %>
      <% end %>
    </div>

    <div class="pure-u-1">
      <ul id="search-results"></ul>
    </div>
  </div>
</div>
